import React, { useState, useMemo, useCallback, useRef, useEffect } from "react";
import Image from "next/image";
import Link from "next/link";

const categories = [
  { name: "–í—Å–µ", value: "–í—Å–µ" },
  { name: "–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ü–û", value: "–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ü–û" },
  { name: "–û–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ", value: "–û–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ" },
  { name: "–°–æ–≤–µ—Ç—ã", value: "–°–æ–≤–µ—Ç—ã" },
  { name: "–û–±—â–µ–µ", value: "–û–±—â–µ–µ" },
  { name: "–û—à–∏–±–∫–∏", value: "–û—à–∏–±–∫–∏" },
];

const blogPosts = [
  {
    title: "–ö–∞–∫ —Å–ø—Ä–∞–≤–∏—Ç—å—Å—è —Å –æ—à–∏–±–∫–æ–π –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ –∞—Ä—Ö–∏–≤–∞",
    image: "/images/blog/post1.jpg",
    excerpt: "–£–∑–Ω–∞–π—Ç–µ, –∫–∞–∫ —Å–ø—Ä–∞–≤–∏—Ç—å—Å—è —Å –Ω–∞–∏–±–æ–ª–µ–µ —á–∞—Å—Ç—ã–º–∏ –æ—à–∏–±–∫–∞–º–∏ –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ –∞—Ä—Ö–∏–≤–æ–≤.",
    link: "/articles/errors/archive",
    category: "–û—à–∏–±–∫–∏",
    keywords: ["–æ—à–∏–±–∫–∏ –∞—Ä—Ö–∏–≤–∞", "–ø—Ä–æ–±–ª–µ–º—ã —Å –∞—Ä—Ö–∏–≤–æ–º", "–æ—à–∏–±–∫–∞ –æ—Ç–∫—Ä—ã—Ç–∏—è –∞—Ä—Ö–∏–≤–∞", "–∞—Ä—Ö–∏–≤"],
  },
  {
    title: "–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ —É—Å—Ç–∞–Ω–æ–≤–∫–µ Autocom 2021",
    image: "/images/blog/post1.jpg",
    excerpt: "–ü–æ–ª–Ω–æ—Ü–µ–Ω–Ω–∞—è, –ø–æ–¥—Ä–æ–±–Ω–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ —É—Å–∞—Ç–Ω–≤–æ–∫–µ –ø—Ä–æ–≥—Ä–∞–º–º–Ω–æ–≥–æ –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è.",
    link: "/articles/software/autocom2021",
    category: "–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ü–û",
    keywords: ["–æ—à–∏–±–∫–∏ –∞—Ä—Ö–∏–≤–∞", "–ø—Ä–æ–±–ª–µ–º—ã —Å –∞—Ä—Ö–∏–≤–æ–º", "–æ—à–∏–±–∫–∞ –æ—Ç–∫—Ä—ã—Ç–∏—è –∞—Ä—Ö–∏–≤–∞", "–∞—Ä—Ö–∏–≤"],
  },
];

export default function Blog() {
  const [selectedCategory, setSelectedCategory] = useState<string>("–í—Å–µ");
  const [searchTerm, setSearchTerm] = useState<string>("");
  const [currentPage, setCurrentPage] = useState<number>(1);

  const postsPerPage = 8;

  const filteredPosts = useMemo(() => {
    const filteredByCategory =
      selectedCategory === "–í—Å–µ"
        ? blogPosts
        : blogPosts.filter((post) => post.category === selectedCategory);
    return filteredByCategory.filter(
      (post) =>
        post.title.toLowerCase().includes(searchTerm.toLowerCase()) ||
        post.excerpt.toLowerCase().includes(searchTerm.toLowerCase()) ||
        post.keywords.some((keyword) =>
          keyword.toLowerCase().includes(searchTerm.toLowerCase())
        )
    );
  }, [selectedCategory, searchTerm]);

  const paginatedPosts = useMemo(() => {
    const startIndex = (currentPage - 1) * postsPerPage;
    return filteredPosts.slice(startIndex, startIndex + postsPerPage);
  }, [currentPage, filteredPosts]);

  const handleCategoryClick = useCallback((category: string) => {
    setSelectedCategory(category);
    setCurrentPage(1);
  }, []);

  return (
    <div className="bg-gray-50 dark:bg-neutral-900" id="blog">
      <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 pt-16">
        <h2 className="text-4xl font-bold text-center">–°—Ç–∞—Ç—å–∏ üíª</h2>
        <p className="pt-6 text-base max-w-2xl text-center m-auto dark:text-neutral-400">
          –í —ç—Ç–æ–º —Ä–∞–∑–¥–µ–ª–µ –≤—ã –º–æ–∂–µ—Ç–µ –Ω–∞–π—Ç–∏ —Å—Ç–∞—Ç—å–∏ –∏ —Ä–µ—à–µ–Ω–∏—è –ø–æ –ø—Ä–æ–≥—Ä–∞–º–º–Ω–æ–º—É –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—é.
        </p>
      </div>

      <div className="max-w-max mx-auto px-6 mt-6 sm:mt-8">
        <div className="relative text-base font-semibold bg-neutral-200 dark:bg-neutral-800 rounded-lg p-1 sm:mt-0 flex items-center justify-between w-full sm:w-auto">
          <div className="flex items-center w-full sm:w-auto flex-grow gap-1">
            <div className="hidden sm:flex flex-wrap gap-1">
              {categories.map((category) => (
                <button
                  key={category.value}
                  onClick={() => handleCategoryClick(category.value)}
                  className={`${
                    category.value === selectedCategory
                      ? "bg-white dark:bg-neutral-600 text-neutral-900 dark:text-neutral-100"
                      : "text-neutral-900 dark:text-neutral-400 hover:bg-white dark:hover:bg-neutral-700"
                  } rounded-md py-2 px-4 whitespace-nowrap transition-colors duration-300 ease-in-out`}
                  aria-label={`–í—ã–±—Ä–∞—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é ${category.name}`}
                >
                  {category.name}
                </button>
              ))}
            </div>
          </div>
        </div>
      </div>

      <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 pt-16 pb-16 grid md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-x-6 gap-y-16">
        {paginatedPosts.length > 0 ? (
          paginatedPosts.map(({ title, image, excerpt, link }) => (
            <div
              key={title}
              className="rounded-lg overflow-hidden flex flex-col border-neutral-300 border dark:border-neutral-600 hover:bg-neutral-100 dark:hover:bg-neutral-700 hover:shadow-lg transition-all duration-300 h-full"
            >
              <Link href={link}>
                <div className="relative h-[200px]">
                  <Image
                    src={image}
                    alt={title}
                    layout="fill"
                    className="w-full object-cover"
                    priority={title === paginatedPosts[0].title}
                    placeholder="blur"
                    blurDataURL="/images/placeholder.png"
                    loading="lazy"
                  />
                </div>
              </Link>
              <div className="p-4 flex flex-col flex-grow">
                <h3
                  className="text-lg font-semibold mb-2 line-clamp-2 h-12 flex items-center justify-center"
                >
                  {title}
                </h3>
                <p
                  className="text-sm text-neutral-600 dark:text-neutral-400 mb-4 line-clamp-3 h-auto min-h-[4.5rem] max-h-[4.5rem] flex items-center"
                >
                  {excerpt}
                </p>
                <div className="mt-auto text-right">
                  <Link href={link}>
                    <button className="bg-red-600 text-white text-sm rounded-md px-4 py-2 transition-colors duration-300 hover:bg-red-500">
                      –ß–∏—Ç–∞—Ç—å –¥–∞–ª–µ–µ
                    </button>
                  </Link>
                </div>
              </div>
            </div>
          ))
        ) : (
          <div className="text-center text-neutral-900 dark:text-neutral-400 col-span-full">
            <h3 className="text-xl font-semibold mb-4">–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</h3>
            <p>–ö —Å–æ–∂–∞–ª–µ–Ω–∏—é, –ø–æ –≤–∞—à–µ–º—É –∑–∞–ø—Ä–æ—Å—É –Ω–µ —É–¥–∞–ª–æ—Å—å –Ω–∞–π—Ç–∏ —Å—Ç–∞—Ç—å–∏. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é –∏–ª–∏ –ø–æ–∏—Å–∫–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å.</p>
          </div>
        )}
      </div>
    </div>
  );
}
